<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <title>Pokémon GO promo kód OCR</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.0.1/dist/tesseract.min.js"></script>
</head>
<body>
  <h2>Načtěte promo kód z kartičky</h2>

  <form id="ocr-form">
    <input type="file" id="image" accept="image/*" capture="environment" required />
    <button type="submit">Přečti kód</button>
  </form>

  <div id="result" style="margin-top: 20px;">
    <textarea id="recognized-text" rows="6" cols="60" placeholder="Zde se zobrazí rozpoznaný text..."></textarea><br />
    <button id="use-code" disabled>Použít označený kód</button>
  </div>

  <script>
    document.getElementById('ocr-form').addEventListener('submit', function (e) {
      e.preventDefault();
      const file = document.getElementById('image').files[0];
      if (!file) return alert('Vyberte obrázek.');

      const reader = new FileReader();
      reader.onload = function () {
        Tesseract.recognize(reader.result, 'eng', { logger: (m) => console.log(m) })
          .then(({ data: { text } }) => {
            document.getElementById('recognized-text').value = text;
            document.getElementById('use-code').disabled = false;
          })
          .catch((err) => {
            alert('Chyba při rozpoznávání textu: ' + err.message);
          });
      };
      reader.readAsDataURL(file);
    });

    document.getElementById('use-code').addEventListener('click', function () {
      const textarea = document.getElementById('recognized-text');
      let selectedText = textarea.value.substring(textarea.selectionStart, textarea.selectionEnd).trim();

      if (!selectedText) {
        alert('Prosím, zvýrazněte promo kód myší nebo prstem v poli výše.');
        return;
      }

      const code = selectedText.replace(/[^A-Z0-9]/gi, '').toUpperCase();
      window.open(`https://store.pokemongo.com/offer-redemption?passcode=${code}`, '_blank');
    });
  </script>
</body>
</html>
